---
layout: article
title:  "初级--单一光源光照"
categories: shader
image:
    teaser: /in-post/shader/2019-09-15-初级--单一光源光照/ScreenShot001.png
---

## 写在前面

本文将简述Blinn-Phong光照模型以及PBS光照模型在UnityShader中的使用。本文只涉及单一光源的光照处理，多光源光照处理请见下一篇-[初级--多光源光照]()。全篇基于Unity2018.3.2。

在PC前的各位读者，建议下载MD文件阅读，观感更好。若有图片无法显示，请开启网络。**欢迎转载，只需注明转载来源地址即可。**[MD文件及工程Package下载地址](https://pan.baidu.com/s/1vPHxxhVKsEFcw1CTpVKdVw)（提取码：bypu）

## Unity中的Workflow

### 1.Metallic Workflow(金属工作流)

有"Metallic"值，表示材质是否为金属性。在使用金属性材质的情况下，反照率颜色(Albedo)将控制镜面反射的颜色，且大多数光线以镜面反射形势反射。非金属性材质将具有与入射光颜色相同的镜面反射，并且在正面观察表面时几乎不会反射。

### 2.SpecularWorkflow(镜面反射工作流)

有镜面反射颜色(Specular)，用于控制材质的镜面反射颜色，镜面反射颜色可与漫反射颜色不同。

## Blinn-Phong光照模型

- **漫反射（diffuse）**

说明：符合***兰伯特定律（Lambert's law）***反射光线的强度与表面法线和光源方向之间夹角的余弦值成正比

计算公式：
$$
c_{diffuse}=（c_{light} \times m_{diffuse}）max（0,\vec{n} \cdot \vec{l}）
$$
其中：

$$
c_{light}：光源的颜色和强度\\
m_{diffuse}： 材质的漫反射颜色\\
\vec{n}：表面法线（单位向量）\\
\vec{l}：光源方向（指向光源的单位向量）
$$

- **高光反射（specular）**

说明：***经验模型***，需要信息：
$$
1.表面法线（\vec{n}）\\
2.视角方向（\vec{v}）\\
3.光源方向（\vec{l}）\\
4.反射方向（\vec{r}）
$$
其中反射方向的计算：

方法一：（***Phong***）
$$
\vec{r} = 2\times（\vec{n} \cdot \vec{l}）\times \vec{n} - \vec{l}
$$
方法二：（***Blinn***）使用新矢量h（光源方向和视角方向的半角向量）代替反射方向矢量。当摄像机与光源距离模型足够远的时候，此方法计算更快。
$$
\vec{h} = \frac{\vec{v} + \vec{l}}{\begin{Vmatrix} \vec{v}+\vec{l}\end{Vmatrix}}
$$
 计算公式：

（***Phong***）
$$
c_{specular}=（c_{light} \times m_{specular}）\times max（0,\vec{v} \cdot \vec{r}）^{Smoothness}
$$
（***Blinn***）
$$
c_{specular}=（c_{light}\times m_{specular}）\times max（0,\vec{n}\cdot \vec{h}）^{Smoothness}
$$
其中：
$$
c_{light}：光源的颜色和强度\\
m_{specular}：材质的高光反射颜色，用于控制材质对于高光反射的强度和颜色\\
Smoothness：材质光泽度/反光度，用于控制高光区域“亮点”有多宽，成反比）
$$

- **实现步骤：**

**1.创建文件夹结构**

使用[HTUtility工具](https://huskytgame.github.io//framework/%E6%97%A5%E5%B8%B8%E5%AD%A6%E4%B9%A0%E4%BD%BF%E7%94%A8%E7%9A%84%E5%B0%8F%E5%B7%A5%E5%85%B7/)(Shift+Alt+G)创建合适的文件夹结构，重命名Root文件夹为"单一光源光照"。在场景中创建胶囊体，Reset到原点位置。创建Material，命名为"SingleLightingMat"；创建Unlit Shader，命名为"SingleLighting"。

**2.设置环境光：**

​                在Unity菜单中点击“Window--Rendering--LightingSettings”。设置天空盒子和环境光(Environment Lighting)。

![picture1](https://huskytgame.github.io/images/in-post/shader/2019-09-15-初级--单一光源光照/ScreenShot001.png)

